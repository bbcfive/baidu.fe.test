<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<select id="year-select">
	    <option value="2000">2000</option>
	    <option value="2001">2001</option>
	    <option value="2002">2002</option>
	    <option value="2003">2003</option>
	    <option value="2004">2004</option>
	    <option value="2005">2005</option>
	    <option value="2006">2006</option>
	    <option value="2007">2007</option>
	    <option value="2008">2008</option>
	    <option value="2009">2009</option>
	    <option value="2010">2010</option>
	    <option value="2011">2011</option>
	    <option value="2012">2012</option>
	    <option value="2013">2013</option>
	    <option value="2014">2014</option>
	    <option value="2015">2015</option>
	    <option value="2016">2016</option>
	    <option value="2017">2017</option>
	    <option value="2018">2018</option>
	    <option value="2019">2019</option>
	    <option value="2020">2020</option>
	    <option value="2021">2021</option>
	    <option value="2022">2022</option>
	    <option value="2023">2023</option>
	    <option value="2024">2024</option>
	    <option value="2025">2025</option>
	    <option value="2026">2026</option>
	    <option value="2027">2027</option>
	    <option value="2028">2028</option>
	    <option value="2029">2029</option>
	    <option value="2030">2030</option>
	    <option value="2031">2031</option>
	    <option value="2032">2032</option>
	</select>

	<select id="month-select">
	    <option value="01">01</option>        
	    <option value="02">02</option>
	    <option value="03">03</option>
	    <option value="04">04</option>
	    <option value="05">05</option>
	    <option value="06">06</option>
	    <option value="07">07</option>
	    <option value="08">08</option>
	    <option value="09">09</option>
	    <option value="10">10</option>
	    <option value="11">11</option>
	    <option value="12">12</option>
	</select>

	<select id="day-select">
	    <option value="01">01</option>        
	    <option value="02">02</option>
	    <option value="03">03</option>
	    <option value="04">04</option>
	    <option value="05">05</option>
	    <option value="06">06</option>
	    <option value="07">07</option>
	    <option value="08">08</option>
	    <option value="09">09</option>
	    <option value="10">10</option>
	    <option value="11">11</option>
	    <option value="12">12</option>
	    <option value="13">13</option>
	    <option value="14">14</option>
	    <option value="15">15</option>
	    <option value="16">16</option>
	    <option value="17">17</option>
	    <option value="18">18</option>
	    <option value="19">19</option>
	    <option value="20">20</option>
	    <option value="21">21</option>
	    <option value="22">22</option>
	    <option value="23">23</option>
		<option value="24">24</option>
		<option value="25">25</option>
		<option value="26">26</option>
		<option value="27">27</option>
		<option value="28">28</option>
		<option value="29">29</option>
		<option value="30">30</option>
	    <option value="31">31</option>
	</select>

	<select id="hour-select">
	    <option value="00">00</option>
	    <option value="01">01</option>        
	    <option value="02">02</option>
	    <option value="03">03</option>
	    <option value="04">04</option>
	    <option value="05">05</option>
	    <option value="06">06</option>
	    <option value="07">07</option>
	    <option value="08">08</option>
	    <option value="09">09</option>
	    <option value="10">10</option>
	    <option value="11">11</option>
	    <option value="12">12</option>
	    <option value="13">13</option>
	    <option value="14">14</option>
	    <option value="15">15</option>
	    <option value="16">16</option>
	    <option value="17">17</option>
	    <option value="18">18</option>
	    <option value="19">19</option>
	    <option value="20">20</option>
	    <option value="21">21</option>
	    <option value="22">22</option>
	    <option value="23">23</option>
	</select>

	<select id="minite-select">
	    <option value="00">00</option>
	    <option value="01">01</option>
	    <option value="02">02</option>
	    <option value="03">03</option>
	    <option value="04">04</option>
	    <option value="05">05</option>
	    <option value="06">06</option>
	    <option value="07">07</option>
	    <option value="08">08</option>
	    <option value="09">09</option>
	    <option value="10">10</option>
	    <option value="11">11</option>
	    <option value="12">12</option>
	    <option value="13">13</option>
	    <option value="14">14</option>
	    <option value="15">15</option>
	    <option value="16">16</option>
	    <option value="17">17</option>
	    <option value="18">18</option>
	    <option value="19">19</option>
	    <option value="20">20</option>
	    <option value="21">21</option>
	    <option value="22">22</option>
	    <option value="23">23</option>
	    <option value="24">24</option>
	    <option value="25">25</option>
	    <option value="26">26</option>
	    <option value="27">27</option>
	    <option value="28">28</option>
	    <option value="29">29</option>
	    <option value="30">30</option>
	    <option value="31">31</option>
	    <option value="32">32</option>
	    <option value="33">33</option>
	    <option value="34">34</option>
	    <option value="35">35</option>
	    <option value="36">36</option>
	    <option value="37">37</option>
	    <option value="38">38</option>
	    <option value="39">39</option>
	    <option value="40">40</option>
	    <option value="41">41</option>
	    <option value="42">42</option>
	    <option value="43">43</option>	 
	    <option value="44">44</option>
	    <option value="45">45</option>
	    <option value="46">46</option>
	    <option value="47">47</option>	 
	    <option value="48">48</option>
	    <option value="49">49</option>
	    <option value="50">50</option>	    
	    <option value="51">51</option>
	    <option value="52">52</option>
	    <option value="53">53</option>
	    <option value="54">54</option>
	    <option value="55">55</option>
	    <option value="56">56</option>
		<option value="57">57</option>
		<option value="58">58</option>
	    <option value="59">59</option>
	</select>

	<select id="second-select">
	    <option value="00">00</option>
	    <option value="01">01</option>
	    <option value="02">02</option>
	    <option value="03">03</option>
	    <option value="04">04</option>
	    <option value="05">05</option>
	    <option value="06">06</option>
	    <option value="07">07</option>
	    <option value="08">08</option>
	    <option value="09">09</option>
	    <option value="10">10</option>
	    <option value="11">11</option>
	    <option value="12">12</option>
	    <option value="13">13</option>
	    <option value="14">14</option>
	    <option value="15">15</option>
	    <option value="16">16</option>
	    <option value="17">17</option>
	    <option value="18">18</option>
	    <option value="19">19</option>
	    <option value="20">20</option>
	    <option value="21">21</option>
	    <option value="22">22</option>
	    <option value="23">23</option>
	    <option value="24">24</option>
	    <option value="25">25</option>
	    <option value="26">26</option>
	    <option value="27">27</option>
	    <option value="28">28</option>
	    <option value="29">29</option>
	    <option value="30">30</option>
	    <option value="31">31</option>
	    <option value="32">32</option>
	    <option value="33">33</option>
	    <option value="34">34</option>
	    <option value="35">35</option>
	    <option value="36">36</option>
	    <option value="37">37</option>
	    <option value="38">38</option>
	    <option value="39">39</option>
	    <option value="40">40</option>
	    <option value="41">41</option>
	    <option value="42">42</option>
	    <option value="43">43</option>	 
	    <option value="44">44</option>
	    <option value="45">45</option>
	    <option value="46">46</option>
	    <option value="47">47</option>	 
	    <option value="48">48</option>
	    <option value="49">49</option>
	    <option value="50">50</option>	    
	    <option value="51">51</option>
	    <option value="52">52</option>
	    <option value="53">53</option>
	    <option value="54">54</option>
	    <option value="55">55</option>
	    <option value="56">56</option>
		<option value="57">57</option>
		<option value="58">58</option>
	    <option value="59">59</option>
	</select>
	<p id="resultSeclect">所选时间：</p>

	<p id="resultNow">当前时间：</p>

	<p id="result-wrapper" style="display: inline;">现在距离 2001年1月1日星期X HH:MM:SS 还有 X 天 X 小时 X 分 X 秒</p>	

	<span id="difference"></span>

	<script type="text/javascript">
		
		var list = document.querySelectorAll('select');
		var resultSeclect = document.getElementById("resultSeclect");
		var resultNow = document.getElementById("resultNow");
		var result_wrapper =document.getElementById("result-wrapper");
		var difference = document.getElementById("difference");

 		//现在时间和所选时间
		function time() {
			/*
			坑详解：
			1.setInterval外没有函数时，函数要用""包起来，才能持续运行
			2.setInterval有层父函数时，""包起来会提示，找不到colck()函数，不包起来函数只会运行一次；此时要删除""和(),只保留clock字样，方可持续运行
			*/

			setInterval(clock,500);

			function getWeekdays(day) {
				var weeks = ["日","一","二","三","四","五","六"];
				return weeks[day];
			}

			function check(i) {
				if (i < 10) 
					i = "0" + i;
				return i;
			}

			//测是否是闰年
			function leap(y) {
				if (((y % 4 == 0)&&(y % 100 != 0))||(y % 400 == 0))
					return true;
			}

			//测是否是大月
			function big(m) {
				if (m == 1 || m == 3 || m == 5 || m == 7 || m == 8 || m == 10 || m == 12)
					return true;
			}		
		
			function clock() {
				//现在时间
				var time = document.getElementById('time');
				var today = new Date();	
				var year = today.getFullYear();
				//返回值是 0（一月） 到 11（十二月） 之间的一个整数
				var month = check(today.getMonth()) + 1;
				var day = check(today.getDate());
				var weekday = getWeekdays(today.getDay());
				var hour = check(today.getHours());
				var minute = check(today.getMinutes());
				var second = check(today.getSeconds());

				resultNow.innerHTML = "当前时间： " + year + '年' + month + '月' + day + '日 ' + '星期' + weekday + "  " + hour + ":" + minute + ":" + second;

				result_wrapper.innerHTML = "现在距离  " + year + '年' + month + '月' + day + '日 ' + '星期' + weekday + "  " + hour + ":" + minute + ":" + second;

				//所选时间
				for (var i = 0; i <list.length; i++) {
					list[i].onchange = function() {
						var yearSelect = document.getElementById("year-select").value;
						var monthSelect = document.getElementById("month-select").value;
						var daySelect = document.getElementById("day-select").value;
						var hourSelect = document.getElementById("hour-select").value;
						var miniteSelect = document.getElementById("minite-select").value;
						var secondSelect = document.getElementById("second-select").value;				
						resultSeclect.innerHTML ="所选时间： " + yearSelect + "年" + monthSelect + "月" + daySelect + "日  " + hourSelect + ":" + miniteSelect + ":" + secondSelect;

						//注意选择不同月份的时候，日期的可选范围不一样
						var day_select = document.getElementById("day-select");
						var day_option = day_select.querySelectorAll("option");
						//console.log(day_option[30]);						
						function range() {
							for (var i = 0; i < day_option.length; i++) {
								day_option[i].style.visibility = "visible";
								if (leap(yearSelect)) {
									if (monthSelect == 2) {
										day_option[30].style.visibility = "hidden";
										day_option[29].style.visibility = "hidden";
									} 
									if (!big(parseInt(monthSelect))) day_option[30].style.visibility = "hidden";
								} else {
									if (monthSelect == 2) {
										day_option[30].style.visibility = "hidden";
										day_option[29].style.visibility = "hidden";
										day_option[28].style.visibility = "hidden";
									} 
									if (!big(parseInt(monthSelect))) day_option[30].style.visibility = "hidden";
								}								
							}
						}						

						//监听全局变化,放最前，说range未定义...放最后，不与range在同一个函数内部...
						document.onchange = range();						

						//时间差
						function getDifference() {
							var timeNow = year.toString() + month.toString() + day.toString() + hour.toString() + minute.toString() + second.toString();
							var timeSelect = yearSelect + monthSelect + daySelect + hourSelect + miniteSelect + secondSelect;

							//计算被选时间与现在时间中间的天数
							function theMiddleYearsDays(start, end) {
								//计算中间有多少闰年
								var theLeapYear = 0;
								for (var i = start + 1; i < end; i++) {	
									//leap year:能被4整除，而不能被100整除的普通闰年和能被400整除的世纪闰年
									if (leap(i)) theLeapYear++; 
								}
								return (end - start - 1)*365 + theLeapYear*1;
							} 

							//计算[平年]的两个月份之间的天数
							function theMiddleMonthsDays(start, end) {
								//计算中间有多少大月
								var bigMonth = 0, feb = 0;
								for (var i = start; i <= end; i++) {
									if (big(i)) bigMonth++;
									if (i == 2) feb++;
								}
								return (end - start + 1)*30 + bigMonth*1 + feb*(-2);	
							}

							//console.log(theMiddleYearsDays(2005, 2018));					

							//计算两边年份相差多少天
							function twoSidesYearsDay() {
								//现在时间超过所选时间
					 			if (parseInt(timeNow) > parseInt(timeSelect)) {
					 				//假设俩都是平年
					 				var thisYearDays = theMiddleMonthsDays(1,month-1) + day - 1;
					 				var selectedYearDays = 365 - (theMiddleMonthsDays(1, parseInt(monthSelect)-1) + parseInt(daySelect));
													 				
					 				if (leap(year) && month > 2) thisYearDays++;
					 				if (leap(parseInt(yearSelect)) && parseInt(monthSelect) <= 2) selectedYearDays++;	
					 				var resultDays = thisYearDays + selectedYearDays + theMiddleYearsDays(parseInt(yearSelect), year);	

									//计算两边年份相差多少小时
									var thisDayTime = (hour*60 + minute)*60 + second;
									var selectedDayTime = 24*60*60 - ((parseInt(hourSelect)*60 + parseInt(miniteSelect))*60 + parseInt(secondSelect));
									var resultTime = thisDayTime + selectedDayTime;	 
									var resultHours = Math.floor(resultTime/3600);
									var resultMinutes = Math.floor((resultTime - resultHours*3600)/60);
									var resultSeconds = resultTime - resultHours*3600 - resultMinutes*60;	
									
									

									if (resultHours > 24) {
										resultDays++;
										resultHours -= 24;
									}			 																
					 				return "已经过去：" + resultDays + "天 " + resultHours + "小时 " + resultMinutes + "分 " + resultSeconds + "秒";
					 			}
					 			//所选时间超过现在时间
					 			else {
					 				var selectedYearDays = theMiddleMonthsDays(1,parseInt(monthSelect)-1) + parseInt(daySelect) - 1;
					 				var thisYearDays = 365 - (theMiddleMonthsDays(1, month-1) + day);

					 				if (leap(year) && month <= 2) thisYearDays++;
					 				if (leap(parseInt(yearSelect)) && parseInt(monthSelect) > 2) selectedYearDays++;	

					 				var resultDays = thisYearDays + selectedYearDays + theMiddleYearsDays(year, parseInt(yearSelect));

									//计算两边年份相差多少小时
									var selectedDayTime = (parseInt(hourSelect)*60 + parseInt(miniteSelect))*60 + parseInt(secondSelect);
									var thisDayTime = 24*60*60 - ((hour*60 + minute)*60 + second);
									var resultTime = thisDayTime + selectedDayTime;	 
									var resultHours = Math.floor(resultTime/3600);
									var resultMinutes = Math.floor((resultTime - resultHours*3600)/60);
									var resultSeconds = resultTime - resultHours*3600 - resultMinutes*60;	
									
									if (resultHours > 24) {
										resultDays++;
										resultHours -= 24;
									}							 				
					 				return "还有：" + resultDays + "天 " + resultHours + "小时 " + resultMinutes + "分 " + resultSeconds + "秒";
					 			}										
							}

							difference.innerHTML = twoSidesYearsDay();
			
						}	

						getDifference();							
					}
		 		}				
			}
		} 
		time();
		
	</script>

</body>
</html>